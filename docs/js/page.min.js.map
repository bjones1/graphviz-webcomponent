{"version":3,"file":"page.min.js","sources":["page.js"],"sourcesContent":["const source = document.getElementById('source')\nconst graph = document.getElementById('graph')\nconst saveSVG = document.getElementById('save-svg')\nconst savePNG = document.getElementById('save-png')\nconst saveScript = document.getElementById('save-script')\nconst svgSizeRegExp = /<svg width=\"(\\d+)pt\" height=\"(\\d+)pt\"/\nlet svg, png, lastError, pendingUpdate, runningUpdate, remainingError\n\ngraph.setAttribute('graph', source.getAttribute('value'))\n\nfunction convertSVGToPNG () {\n  return new Promise((resolve, reject) => {\n    const size = svgSizeRegExp.exec(svg)\n    if (!size) throw new Error('Unknown SVG size.')\n    const canvas = document.createElement('canvas')\n    canvas.width = size[1] / 0.75\n    canvas.height = size[2] / 0.75\n    const context = canvas.getContext('2d')\n    const image = document.createElement('img')\n    image.onload = () => {\n      try {\n        context.drawImage(image, 0, 0)\n        canvas.toBlob(resolve)\n      } catch (error) {\n        reject(error)\n      }\n    }\n    image.onerror = () => reject(new Error('PNG conversion failed.'))\n    image.src = `data:image/svg+xml;base64,${btoa(svg)}`\n  })\n}\n\nasync function rememberImage ({ detail }) {\n  runningUpdate = false\n  lastError = undefined\n  svg = detail\n  saveSVG.disabled = false\n  try {\n    png = await convertSVGToPNG()\n    savePNG.disabled = false\n  } catch ({ message }) {\n    alert(message)\n  }\n}\n\nfunction forgetImage () {\n  svg = png = runningUpdate = lastError = undefined\n  saveSVG.disabled = savePNG.disabled = true\n}\n\nfunction downloadFile (blob) {\n  const link = document.createElement('a')\n  const type = blob.type\n  link.download = type === 'image/png'\n    ? 'graph.png'\n    : type === 'image/svg+xml' ? 'graph.svg' : 'graph.dot'\n  document.body.appendChild(link)\n  const url = URL.createObjectURL(blob)\n  link.href = url\n  link.click()\n  document.body.removeChild(link)\n  URL.revokeObjectURL(url)\n}\n\nfunction displayError () {\n  clearTimeout(remainingError)\n  remainingError = undefined\n  if (pendingUpdate || runningUpdate || !lastError) return\n  graph.graph = source.value\n}\n\nfunction scheduleDisplayError () {\n  if (remainingError) clearTimeout(remainingError)\n  remainingError = setTimeout(displayError, 300)\n}\n\nasync function tryUpdateGraph () {\n  if (runningUpdate) return scheduleUpdateGraph()\n  clearTimeout(pendingUpdate)\n  pendingUpdate = undefined\n  runningUpdate = true\n  lastError = undefined\n  const value = source.value\n  if (value) {\n    try {\n      await graph.tryGraph(value)\n    } catch (error) {\n      runningUpdate = false\n      lastError = error\n      scheduleDisplayError()\n    }\n  } else {\n    graph.graph = value\n    forgetImage()\n  }\n}\n\nfunction scheduleUpdateGraph () {\n  if (pendingUpdate) clearTimeout(pendingUpdate)\n  pendingUpdate = setTimeout(tryUpdateGraph, 300)\n}\n\nfunction saveAsSVG () {\n  downloadFile(new Blob([svg], { type: 'image/svg+xml' }))\n}\n\nfunction saveAsPNG () {\n  downloadFile(png)\n}\n\nfunction saveAsText () {\n  downloadFile(new Blob([graph.graph], { type: 'text/plain' }))\n}\n\nsource.addEventListener('input', scheduleUpdateGraph)\ngraph.addEventListener('render', rememberImage)\ngraph.addEventListener('error', forgetImage)\nsaveSVG.addEventListener('click', saveAsSVG)\nsavePNG.addEventListener('click', saveAsPNG)\nsaveScript.addEventListener('click', saveAsText)\n"],"names":["svg","png","lastError","pendingUpdate","runningUpdate","remainingError","source","document","getElementById","graph","saveSVG","savePNG","saveScript","svgSizeRegExp","rememberImage","detail","undefined","disabled","Promise","resolve","reject","size","exec","Error","canvas","createElement","width","height","context","getContext","image","onload","drawImage","toBlob","error","onerror","src","btoa","message","alert","forgetImage","downloadFile","blob","link","type","download","body","appendChild","url","URL","createObjectURL","href","click","removeChild","revokeObjectURL","displayError","clearTimeout","value","tryUpdateGraph","scheduleUpdateGraph","tryGraph","setTimeout","setAttribute","getAttribute","addEventListener","Blob"],"mappings":"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"}